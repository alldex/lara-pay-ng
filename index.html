<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>LaraPay NG by dammyammy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">LaraPay NG</h1>
      <h2 class="project-tagline">All in one Payment Solution For Laravel 5 (Nigerian Specific Providers e.g. GTPay, VoguePay, WebPay, SimplePay, CashEnvoy)</h2>
      <a href="https://github.com/dammyammy/lara-pay-ng" class="btn">View on GitHub</a>
      <a href="https://github.com/dammyammy/lara-pay-ng/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/dammyammy/lara-pay-ng/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="nigerian-payment-gateway-solution-for-laravel-5" class="anchor" href="#nigerian-payment-gateway-solution-for-laravel-5" aria-hidden="true"><span class="octicon octicon-link"></span></a>Nigerian Payment Gateway Solution for Laravel 5</h1>

<ul>
<li>Supports Multiple Gateways with a single API approach, meaning Integration is the same across board in code</li>
</ul>

<p>*** Do Not Use, Currently being developed to be compatible with the latest version of Laravel.</p>

<p>Aiming to Integrate as much Payment Gateways As Possible</p>

<p>Currently Supported</p>

<ul>
<li>VoguePay</li>
<li>GTPay</li>
</ul>

<p>Gateways Currently being Looked at (In development)</p>

<ul>
<li>WebPay</li>
<li>CashEnvoy</li>
<li>SimplePay</li>
</ul>

<h1>
<a id="to-install" class="anchor" href="#to-install" aria-hidden="true"><span class="octicon octicon-link"></span></a>To Install</h1>

<p>Simply Run</p>

<div class="highlight highlight-bash"><pre>    composer require dammyammy/lara-pay-ng</pre></div>

<p>Next Add the Service Provider into your Providers Array in config/app.php</p>

<div class="highlight highlight-php"><pre><span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>providers<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c">         * Laravel Framework Service Providers...</span></span>
<span class="pl-s1"><span class="pl-c">         */</span></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>Illuminate\Foundation\Providers\ArtisanServiceProvider<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>Illuminate\Auth\AuthServiceProvider<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">....</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>LaraPayNG\Providers\LaraPayNGServiceProvider<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">    ],</span></pre></div>

<p>Next Publish All Package Files</p>

<div class="highlight highlight-shell"><pre>    php artisan vendor:publish</pre></div>

<p>This Would create the following:</p>

<pre><code>1. A **PaymentController** in app/Http/Controllers/PaymentController.php
(i.e This is a working Sample, you may need to change Namespace to match your Projects namespace)

2. **Migrations** would be published to database/migrations

3. 4 Views, matching the Controller
    - one with a simulated checkout out button
    - one is the proceed to pay page (Pay Now Button)
    - one is a success notification Url, Showing a Successful Transaction
    - one is a failure notification Url, Showing a Failed Transaction
</code></pre>

<p>Next Add the following to your routes page in app/Http/routes.php and edit as you seem fit, But be sure specified values match Your Config file</p>

<div class="highlight highlight-php"><pre><span class="pl-s1">    <span class="pl-c1">Route</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>orders<span class="pl-pds">'</span></span>,  [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>as<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>orders<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>uses<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>PaymentController@orders<span class="pl-pds">'</span></span></span>
<span class="pl-s1">    ]);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c1">Route</span><span class="pl-k">::</span>get(<span class="pl-s"><span class="pl-pds">'</span>checkout<span class="pl-pds">'</span></span>,  [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>as<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>checkout<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>uses<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>PaymentController@checkout<span class="pl-pds">'</span></span></span>
<span class="pl-s1">    ]);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$successUrl</span> <span class="pl-k">=</span> config(<span class="pl-s"><span class="pl-pds">'</span>lara-pay-ng.gateways.routes.success_route<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-smi">$successName</span> <span class="pl-k">=</span> config(<span class="pl-s"><span class="pl-pds">'</span>lara-pay-ng.gateways.routes.success_route_name<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$failureUrl</span> <span class="pl-k">=</span> config(<span class="pl-s"><span class="pl-pds">'</span>lara-pay-ng.gateways.routes.failure_route<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-smi">$failureName</span> <span class="pl-k">=</span> config(<span class="pl-s"><span class="pl-pds">'</span>lara-pay-ng.gateways.routes.failure_route_name<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c1">Route</span><span class="pl-k">::</span>post(<span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$successUrl</span> <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>/{mert_id}<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>as<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$successName</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>uses<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>PaymentController@success<span class="pl-pds">'</span></span></span>
<span class="pl-s1">    ]);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c1">Route</span><span class="pl-k">::</span>post(<span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$failureUrl</span> <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>/{mert_id}<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>as<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$failureName</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>uses<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>PaymentController@failed<span class="pl-pds">'</span></span></span>
<span class="pl-s1">    ]);</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c1">Route</span><span class="pl-k">::</span>post(<span class="pl-s"><span class="pl-pds">'</span>/payment-notification/{mert_id}<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>as<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>payment-notification<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>uses<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>PaymentController@notification<span class="pl-pds">'</span></span></span>
<span class="pl-s1">    ]);</span></pre></div>

<h1>
<a id="remember-to-disallow-csrf-token-verification-for-your-payment-routes" class="anchor" href="#remember-to-disallow-csrf-token-verification-for-your-payment-routes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Remember to Disallow CSRF Token Verification for your payment routes</h1>

<p>This is perhaps one of the use cases in which u need to absolutely do this.</p>

<p>Else When a Transaction Id is been sent back Your site would throw a TokenMismatchException</p>

<p>As the Gateway Provider is posting back, and doesn't have a token Generated from your app</p>

<p>Use the appropriate route endpoints if you did change the default names and urls</p>

<div class="highlight highlight-php"><pre><span class="pl-s1">    <span class="pl-k">&lt;</span>?<span class="pl-c1">php</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">namespace</span> <span class="pl-en">App\Http\Middleware</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">Illuminate\Foundation\Http\Middleware\VerifyCsrfToken</span> <span class="pl-k">as</span> <span class="pl-c1">BaseVerifier</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">class</span> <span class="pl-en">VerifyCsrfToken</span> <span class="pl-k">extends</span> <span class="pl-e">BaseVerifier</span></span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">         * The URIs that should be excluded from CSRF verification.</span></span>
<span class="pl-s1"><span class="pl-c">         *</span></span>
<span class="pl-s1"><span class="pl-c">         * <span class="pl-k">@var</span> array</span></span>
<span class="pl-s1"><span class="pl-c">         */</span></span>
<span class="pl-s1">        <span class="pl-k">protected</span> <span class="pl-smi">$except</span> <span class="pl-k">=</span> [</span>
<span class="pl-s1">            <span class="pl-c">//</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>transaction-failed/*<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>transaction-successful/*<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>payment-notification/*<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1"></span>
<span class="pl-s1">        ];</span>
<span class="pl-s1">    }</span></pre></div>

<p>Next Migrate the Package Tables.</p>

<div class="highlight highlight-shell"><pre>    php artisan migrate
</pre></div>

<p>Next, Test the default Controller by visiting /Orders and follow through.</p>

<p>The Important thing to note is, to Inject the Payment Functionality into a controller,
all you need do is to Inject the PaymentGatewayManager Class into that controller, and you
Instantly gain access to all the methods provided by the facades below.</p>

<div class="highlight highlight-php"><pre><span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">LaraPayNG\Exceptions\UnknownPaymentGatewayException</span>;</span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">LaraPayNG\Managers\PaymentGatewayManager</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">class</span> <span class="pl-en">PaymentController</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span></span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">         * <span class="pl-k">@var</span> PaymentGateway</span></span>
<span class="pl-s1"><span class="pl-c">         */</span></span>
<span class="pl-s1">        <span class="pl-k">private</span> <span class="pl-smi">$paymentGateway</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">         * <span class="pl-k">@param</span> PaymentGatewayManager $paymentGateway</span></span>
<span class="pl-s1"><span class="pl-c">         */</span></span>
<span class="pl-s1">        <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-c1">__construct</span>(<span class="pl-c1">PaymentGatewayManager</span> <span class="pl-smi">$paymentGateway</span>)</span>
<span class="pl-s1">        {</span>
<span class="pl-s1">            <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">paymentGateway</span> <span class="pl-k">=</span> <span class="pl-smi">$paymentGateway</span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">....</span></span>
<span class="pl-s1"></span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1"></span></pre></div>

<h1>
<a id="facades" class="anchor" href="#facades" aria-hidden="true"><span class="octicon octicon-link"></span></a>Facades</h1>

<pre><code>Facades         Namespace                                   When To Use Which Facade

Pay::           \LaraPayNG\Facades\Pay            Use If You want To Swap Gateways Through Config.
GTPay::         \LaraPayNG\Facades\GTPay          Use If You Specifically want GTPay Gateway.
WebPay::        \LaraPayNG\Facades\WebPay         Use If You Specifically want WebPay Gateway.
VoguePay::       \LaraPayNG\Facades\VoguePay      Use If You Specifically want VoguePay Gateway.
</code></pre>

<h1>
<a id="methods-available-via-facades--paymentgatewaymanager-injection" class="anchor" href="#methods-available-via-facades--paymentgatewaymanager-injection" aria-hidden="true"><span class="octicon octicon-link"></span></a>Methods Available Via Facades / PaymentGatewayManager Injection</h1>

<pre><code>Method                                                               What it is Meant For

payButton($transactionId, $transactionData, $class, $buttonTitle)   To create Pay Now Button For Set Gateway In a View.
logTransaction($transactionData)                                    To Store Data Transaction Being Made for future Reference.
receiveTransactionResponse($transactionId, $mertId)                 To Get Transaction Response back from Gateway
logResponse($transactionData)                                       To Store Transaction Response from Gateway.

getDefaultDriver()                                                  To get Default Payment Gateway Driver At Runtime.
setDefaultDriver($name)                                             To set Default Payment Gateway Driver At Runtime..
config($key)                                                        Access Config Off Set Default Payment Gateway Driver.
</code></pre>

<h1>
<a id="exceptions" class="anchor" href="#exceptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exceptions</h1>

<pre><code>All Exceptions Exist Under This Namespace;;

```php

    namespace \LaraPayNG\Exceptions;
```

Exceptions                                  When It is Thrown

UnknownPaymentGatewayException              If set Driver for Default Gateway is unknown or unsupported.
UnspecifiedTransactionAmountException       If amount(WebPay) | gtpay_tranx_amt(GTPay) is not in $transactionData.
UnspecifiedPayItemIdException               If pay_item_id is unspecifed in $transactionData array (GTPay)
PaymentGatewayVerificationFailedException   If Hash Calculation is Wrong During Verification ( Applies to GTPay/WebPay Gateway ).
</code></pre>

<h1>
<a id="commands" class="anchor" href="#commands" aria-hidden="true"><span class="octicon octicon-link"></span></a>Commands</h1>

<pre><code>There is a Command to Help Clear Stale Records That have been logged within a set number of days

To Use Simply Type in your terminal

```bash

    # php artisan lara-pay-ng:purge-database gatewayname --days=3 --with-failed=false
    php artisan lara-pay-ng:purge-database

```

You can Pass the gatewayname attribute to the Command eg. gtpay, voguepay. This is particularly useful for Multi-gateway Setups
In the event of not passing the option, the default gateway driver from set config would be used.

It also can be passed a --with-failed option which accepts true/false. True means all Transactions that failed should be included in the deletion,
as well as a --days option specifying how many days back data is considered old.
</code></pre>

<h1>
<a id="tips" class="anchor" href="#tips" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tips</h1>

<pre><code>    Add Methods Like These to Your Helpers.php File then Autoload It In Your composer.json

 ```php

     public function generateTransactionData($dessert, $transactionId)
     {
         return 'name=' . $dessert-&gt;present()-&gt;name . ';pre=' . $dessert-&gt;present()-&gt;buyPrice
         . ';buyer=' . currentUserName() . '; transactionId=' . $transactionId;
     }




     public function generateTransactionMemo($product)
     {
         return 'Name: ' . $product-&gt;name . '; Price: ' . $product-&gt;price
         . '; Buyer: ' . Auth::user()-&gt;email;
     }
 ```

 then You can easily Do

 ```php
    $product = Product::get('2');

    $transactionData = [
        'amount' =&gt; $product-&gt;price,
        'memo' =&gt; generateTransactionMemo($product),
        ...
    ];

    WebPay::payButton($product-&gt;id, $transactionData, 'btn btn-success', '&lt;i class="fa fa-currency"&gt;&lt;/i&gt; Pay Now');

 ```
</code></pre>

<p>## TODO</p>

<ul>
<li>Refactor Code</li>
<li>Create a Simple Straightforward API</li>
<li>Ability to Handle Transaction From Start to Finish</li>
<li>Back everything up with Tests.</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/dammyammy/lara-pay-ng">LaraPay NG</a> is maintained by <a href="https://github.com/dammyammy">dammyammy</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

