<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>LaraPay NG by dammyammy</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>LaraPay NG</h1>
        <p>All in one Payment Solution For Laravel 5 (Nigerian Specific Providers e.g. GTPay, VoguePay, WebPay, SimplePay, CashEnvoy)</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/dammyammy/lara-pay-ng" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/dammyammy/lara-pay-ng/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/dammyammy/lara-pay-ng/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>
<a id="nigerian-payment-gateway-solution-for-laravel-5" class="anchor" href="#nigerian-payment-gateway-solution-for-laravel-5" aria-hidden="true"><span class="octicon octicon-link"></span></a>Nigerian Payment Gateway Solution for Laravel 5</h1>

<ul>
<li>Supports Multiple Gateways with a single API approach, meaning Integration is the same across board in code</li>
</ul>

<p>*** Do Not Use, Currently being developed to be compatible with the latest version of Laravel.</p>

<p>Aiming to Integrate as much Payment Gateways As Possible</p>

<p>Currently Supported</p>

<ul>
<li>VoguePay</li>
<li>GTPay</li>
</ul>

<p>Gateways Currently being Looked at (In development)</p>

<ul>
<li>WebPay</li>
<li>CashEnvoy</li>
<li>SimplePay</li>
</ul>

<h1>
<a id="to-install" class="anchor" href="#to-install" aria-hidden="true"><span class="octicon octicon-link"></span></a>To Install</h1>

<p>Simply Run</p>

<pre><code>
    composer require dammyammy/lara-pay-ng

</code></pre>

<p>Next Add the Service Provider into your Providers Array in config/app.php</p>

<pre><code>
    'providers' =&gt; [

        /*
         * Laravel Framework Service Providers...
         */
        'Illuminate\Foundation\Providers\ArtisanServiceProvider',
        'Illuminate\Auth\AuthServiceProvider',

        ....

        'LaraPayNG\Providers\LaraPayNGServiceProvider',
    ],
</code></pre>

<p>Next Publish All Package Files</p>

<pre><code>
    php artisan vendor:publish

</code></pre>

<p>This Would create the following:</p>

<pre><code>1. A **PaymentController** in app/Http/Controllers/PaymentController.php
(i.e This is a working Sample, you may need to change Namespace to match your Projects namespace)

2. **Migrations** would be published to database/migrations

3. 4 Views, matching the Controller
    - one with a simulated checkout out button
    - one is the proceed to pay page (Pay Now Button)
    - one is a success notification Url, Showing a Successful Transaction
    - one is a failure notification Url, Showing a Failed Transaction
</code></pre>

<p>Next Add the following to your routes page in app/Http/routes.php and edit as you seem fit, But be sure specified values match Your Config file</p>

<pre><code>
    Route::get('orders',  [
        'as' =&gt; 'orders',
        'uses' =&gt; 'PaymentController@orders'
    ]);


    Route::get('checkout',  [
        'as' =&gt; 'checkout',
        'uses' =&gt; 'PaymentController@checkout'
    ]);

    $successUrl = config('lara-pay-ng.gateways.routes.success_route');
    $successName = config('lara-pay-ng.gateways.routes.success_route_name');

    $failureUrl = config('lara-pay-ng.gateways.routes.failure_route');
    $failureName = config('lara-pay-ng.gateways.routes.failure_route_name');


    Route::post('/' . $successUrl . '/{mert_id}', [
        'as' =&gt; $successName,
        'uses' =&gt; 'PaymentController@success'
    ]);

    Route::post('/' . $failureUrl . '/{mert_id}', [
        'as' =&gt; $failureName,
        'uses' =&gt; 'PaymentController@failed'
    ]);

    Route::post('/payment-notification/{mert_id}', [
        'as' =&gt; 'payment-notification',
        'uses' =&gt; 'PaymentController@notification'
    ]);



</code></pre>

<h1>
<a id="remember-to-disallow-csrf-token-verification-for-your-payment-routes" class="anchor" href="#remember-to-disallow-csrf-token-verification-for-your-payment-routes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Remember to Disallow CSRF Token Verification for your payment routes</h1>

<p>This is perhaps one of the use cases in which u need to absolutely do this.</p>

<p>Else When a Transaction Id is been sent back Your site would throw a TokenMismatchException</p>

<p>As the Gateway Provider is posting back, and doesn't have a token Generated from your app</p>

<p>Use the appropriate route endpoints if you did change the default names and urls</p>

<pre><code>
    &lt;?php

    namespace App\Http\Middleware;

    use Illuminate\Foundation\Http\Middleware\VerifyCsrfToken as BaseVerifier;

    class VerifyCsrfToken extends BaseVerifier
    {
        /**
         * The URIs that should be excluded from CSRF verification.
         *
         * @var array
         */
        protected $except = [
            //

            'transaction-failed/*',
            'transaction-successful/*',
            'payment-notification/*',

        ];
    }
</code></pre>

<p>Next Migrate the Package Tables.</p>

<pre><code>
    php artisan migrate

</code></pre>

<p>Next, Test the default Controller by visiting /Orders and follow through.</p>

<p>The Important thing to note is, to Inject the Payment Functionality into a controller,
all you need do is to Inject the PaymentGatewayManager Class into that controller, and you
Instantly gain access to all the methods provided by the facades below.</p>

<pre><code>
    use LaraPayNG\Exceptions\UnknownPaymentGatewayException;
    use LaraPayNG\Managers\PaymentGatewayManager;

    class PaymentController extends Controller
    {
        /**
         * @var PaymentGateway
         */
        private $paymentGateway;


        /**
         * @param PaymentGatewayManager $paymentGateway
         */
        public function __construct(PaymentGatewayManager $paymentGateway)
        {
            $this-&gt;paymentGateway = $paymentGateway;
        }

        ....

    }



</code></pre>

<h1>
<a id="facades" class="anchor" href="#facades" aria-hidden="true"><span class="octicon octicon-link"></span></a>Facades</h1>

<pre><code>Facades         Namespace                                   When To Use Which Facade

Pay::           \LaraPayNG\Facades\Pay            Use If You want To Swap Gateways Through Config.
GTPay::         \LaraPayNG\Facades\GTPay          Use If You Specifically want GTPay Gateway.
WebPay::        \LaraPayNG\Facades\WebPay         Use If You Specifically want WebPay Gateway.
VoguePay::       \LaraPayNG\Facades\VoguePay      Use If You Specifically want VoguePay Gateway.
</code></pre>

<h1>
<a id="methods-available-via-facades--paymentgatewaymanager-injection" class="anchor" href="#methods-available-via-facades--paymentgatewaymanager-injection" aria-hidden="true"><span class="octicon octicon-link"></span></a>Methods Available Via Facades / PaymentGatewayManager Injection</h1>

<pre><code>Method                                                               What it is Meant For

payButton($transactionId, $transactionData, $class, $buttonTitle)   To create Pay Now Button For Set Gateway In a View.
logTransaction($transactionData)                                    To Store Data Transaction Being Made for future Reference.
receiveTransactionResponse($transactionId, $mertId)                 To Get Transaction Response back from Gateway
logResponse($transactionData)                                       To Store Transaction Response from Gateway.

getDefaultDriver()                                                  To get Default Payment Gateway Driver At Runtime.
setDefaultDriver($name)                                             To set Default Payment Gateway Driver At Runtime..
config($key)                                                        Access Config Off Set Default Payment Gateway Driver.
</code></pre>

<h1>
<a id="exceptions" class="anchor" href="#exceptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exceptions</h1>

<pre><code>All Exceptions Exist Under This Namespace;;

```php

    namespace \LaraPayNG\Exceptions;
```

Exceptions                                  When It is Thrown

UnknownPaymentGatewayException              If set Driver for Default Gateway is unknown or unsupported.
UnspecifiedTransactionAmountException       If amount(WebPay) | gtpay_tranx_amt(GTPay) is not in $transactionData.
UnspecifiedPayItemIdException               If pay_item_id is unspecifed in $transactionData array (GTPay)
PaymentGatewayVerificationFailedException   If Hash Calculation is Wrong During Verification ( Applies to GTPay/WebPay Gateway ).
</code></pre>

<h1>
<a id="commands" class="anchor" href="#commands" aria-hidden="true"><span class="octicon octicon-link"></span></a>Commands</h1>

<pre><code>There is a Command to Help Clear Stale Records That have been logged within a set number of days

To Use Simply Type in your terminal

```bash

    # php artisan lara-pay-ng:purge-database gatewayname --days=3 --with-failed=false
    php artisan lara-pay-ng:purge-database

```

You can Pass the gatewayname attribute to the Command eg. gtpay, voguepay. This is particularly useful for Multi-gateway Setups
In the event of not passing the option, the default gateway driver from set config would be used.

It also can be passed a --with-failed option which accepts true/false. True means all Transactions that failed should be included in the deletion,
as well as a --days option specifying how many days back data is considered old.
</code></pre>

<h1>
<a id="tips" class="anchor" href="#tips" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tips</h1>

<pre><code>    Add Methods Like These to Your Helpers.php File then Autoload It In Your composer.json

 ```php

     public function generateTransactionData($dessert, $transactionId)
     {
         return 'name=' . $dessert-&gt;present()-&gt;name . ';pre=' . $dessert-&gt;present()-&gt;buyPrice
         . ';buyer=' . currentUserName() . '; transactionId=' . $transactionId;
     }




     public function generateTransactionMemo($product)
     {
         return 'Name: ' . $product-&gt;name . '; Price: ' . $product-&gt;price
         . '; Buyer: ' . Auth::user()-&gt;email;
     }
 ```

 then You can easily Do

 ```php
    $product = Product::get('2');

    $transactionData = [
        'amount' =&gt; $product-&gt;price,
        'memo' =&gt; generateTransactionMemo($product),
        ...
    ];

    WebPay::payButton($product-&gt;id, $transactionData, 'btn btn-success', '&lt;i class="fa fa-currency"&gt;&lt;/i&gt; Pay Now');

 ```
</code></pre>

<p>## TODO</p>

<ul>
<li>Refactor Code</li>
<li>Create a Simple Straightforward API</li>
<li>Ability to Handle Transaction From Start to Finish</li>
<li>Back everything up with Tests.</li>
</ul>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/dammyammy">dammyammy</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
